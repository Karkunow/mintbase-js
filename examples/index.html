<!DOCTYPE html>
<html>
  <head>
    <title>Mintbase.js Example</title>
    <script src="./mintbase.js"></script>
  </head>
  <body>
    <h1 id="loading"></h1>
    <p>Example of app using Mintbase.js</p>
    <p>Connected as: <span id="accountId"></span></p>
    <p>Balance: <span id="balance"></span></p>
    <p>Allowance: <span id="allowance"></span></p>

    <img id="marketImg" style="height: 300px; width: 300px" />

    <div>
      <button onclick="connect()">Connect</button>
      <button onclick="fetchMarketplace()">Fetch Marketplace</button>
      <button onclick="getMinterData()">Get Minter Data</button>
    </div>

    <input id="file" type="file" />
    <button onclick="mint()">Mint</button>

    <script>
      let wallet = new Mintbase.Wallet({ networkName: 'testnet' })

      const getMinterData = () => {
        console.log(wallet.minter.currentMint)
      }

      const connect = async () => {
        wallet.connect()

        const details = await wallet.details()

        console.log(details)
        /*const details = await wallet.details()

        document.querySelector('#accountId').textContent = details?.accountId
        document.querySelector('#balance').textContent = details?.balance
        document.querySelector('#allowance').textContent = details?.allowance*/
      }

      const fetchMarketplace = async () => {
        const market = await wallet.api.fetchMarketplace()

        console.log(market)

        document
          .querySelector('#marketImg')
          .setAttribute('src', market[0].metadata.image)
      }

      const mint = async () => {
        const loading = document.querySelector('#loading')
        const file = document.querySelector('#file').files[0]

        loading.textContent = 'Loading...'

        wallet.minter.setField('name', 'test file upload')
        await wallet.minter.upload('image', file)

        loading.textContent = ''

        // await wallet.mint('3xr.mintbase13.testnet')
      }

      connect()
    </script>
  </body>
</html>
